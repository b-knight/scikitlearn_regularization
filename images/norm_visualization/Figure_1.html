<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D Regularization Plot</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        #canvas {
            border: 1px solid #333;
            background: white;
        }

        .download-btn {
            display: block;
            margin: 20px auto;
            padding: 12px 24px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        .download-btn:hover {
            background: #2980b9;
        }
    </style>
</head>

<body>
    <div class="container">
        <canvas id="canvas" width="880" height="480"></canvas>
        <button class="download-btn" onclick="downloadImage()">Download PNG</button>
    </div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;
        canvas.width = 880 * dpr;
        canvas.height = 480 * dpr;
        canvas.style.width = '880px';
        canvas.style.height = '480px';
        ctx.scale(dpr, dpr);

        const colors = {
            original: '#000000',
            l0: '#D55E00',
            l1: '#0173B2',
            l2: '#CC78BC',
            constraint: '#999999',
            axes: '#333333',
            grid: '#eeeeee'
        };

        const centerX = 100;
        const centerY = 380;
        const scale = 120;
        const originalCoeff = [3.2, 1.4];
        const l0Coeff = [1, 0];
        const l1Coeff = [2.5, 0];
        const l2Direction = Math.atan2(0.98, 2.24);
        const l2ConstraintRadius = 2.5;
        const l2Coeff = [
            l2ConstraintRadius * Math.cos(l2Direction),
            l2ConstraintRadius * Math.sin(l2Direction)
        ];

        function drawGrid() {
            ctx.strokeStyle = colors.grid;
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                if (i === 0) continue;
                ctx.beginPath();
                ctx.moveTo(centerX + i * scale, 80);
                ctx.lineTo(centerX + i * scale, 430);
                ctx.stroke();
            }
            for (let i = 1; i <= 2.8; i += 0.5) {
                ctx.beginPath();
                ctx.moveTo(50, centerY - i * scale);
                ctx.lineTo(800, centerY - i * scale);
                ctx.stroke();
            }
        }

        function drawAxes() {
            ctx.strokeStyle = colors.axes;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(800, centerY);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX, 80);
            ctx.stroke();
            ctx.fillStyle = colors.axes;
            ctx.font = 'bold 30px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('β₂', 770, centerY + 32);
            ctx.fillText('β₁', centerX - 51, 100);
            ctx.font = '22px Arial';
            for (let i = 1; i <= 5; i++) {
                ctx.fillText(i.toFixed(1), centerX + i * scale, centerY + 20);
            }
            ctx.textAlign = 'right';
            for (let i = 0.5; i <= 2.8; i += 0.5) {
                ctx.fillText(i.toFixed(1), centerX - 10, centerY - i * scale + 5);
            }
            ctx.textAlign = 'center';
        }


        function drawConstraintRegions() {
            const radius = 2.5;
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.save();
            ctx.beginPath();
            ctx.rect(centerX, 80, 800 - centerX, centerY - 80);
            ctx.clip();
            ctx.strokeStyle = '#66A3D9';
            ctx.beginPath();
            ctx.moveTo(centerX + radius * scale, centerY - 8);
            ctx.lineTo(centerX, centerY - radius * scale);
            ctx.lineTo(centerX - radius * scale, centerY - 8);
            ctx.lineTo(centerX, centerY + radius * scale - 8);
            ctx.closePath();
            ctx.stroke();
            ctx.strokeStyle = '#E4B3D6';
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * scale, 0, 2 * Math.PI);
            ctx.stroke();
            ctx.restore();
            ctx.setLineDash([10, 5]);
            ctx.strokeStyle = colors.l0;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX + 3, centerY + 3);
            ctx.lineTo(800, centerY + 3);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(centerX + 3, centerY);
            ctx.lineTo(centerX + 3, 80);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function drawVector(coeff, color, label, offset = 0) {
            const x = centerX + coeff[0] * scale;
            const y = centerY - coeff[1] * scale;
            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(x, y, 7, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(x, y, 3, 0, 2 * Math.PI);
            ctx.fill();
            let labelX = x + 5;
            let labelY = y - 5 + offset;
            let coordY = y + 10 + offset;
            if (label === 'L0 Post-Regularization') {
                labelX = x + 5;
                labelY = y - 5 + offset - 30;
                coordY = y + 10 + offset - 30;
            } else if (label === 'L1 Post-Regularization') {
                labelX = x + 5;
                labelY = y + 12 + offset;
                coordY = y + 32 + offset;
            } else if (label === 'L2 Post-Regularization') {
                labelX = x + 5;
                labelY = y - 5 + offset - 18;
                coordY = y + 10 + offset - 18;
            } else {
                if (Math.abs(y - centerY) < 15) {
                    labelY = y - 25 + offset;
                    coordY = y - 10 + offset;
                }
                if (Math.abs(x - centerX) < 15) {
                    labelX = x + 10;
                }
            }
            ctx.fillStyle = color;
            ctx.font = 'bold 21px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(label, labelX, labelY);
            ctx.font = '18px Arial';
            ctx.fillText(`(${coeff[0].toFixed(1)}, ${coeff[1].toFixed(1)})`, labelX, coordY);
        }

        function drawContourLines() {
            ctx.strokeStyle = '#cccccc';
            ctx.lineWidth = 2;
            ctx.setLineDash([3, 3]);
            ctx.save();
            ctx.beginPath();
            ctx.rect(centerX, centerY - 2.5 * scale, 5.5 * scale, 3.5 * scale);
            ctx.clip();
            const aspectRatio = 1.3;
            const centerXCoord = originalCoeff[0];
            const centerYCoord = originalCoeff[1];
            const l0_dx = l0Coeff[0] - centerXCoord;
            const l0_dy = l0Coeff[1] - centerYCoord;
            const l0_b_squared = (4.84 / (aspectRatio * aspectRatio)) + 1.96;
            const l0_b = Math.sqrt(l0_b_squared);
            const l0_a = aspectRatio * l0_b;
            ctx.beginPath();
            ctx.ellipse(centerX + centerXCoord * scale, centerY - centerYCoord * scale,
                l0_a * scale, l0_b * scale, 0, 0, 2 * Math.PI);
            ctx.stroke();
            const l1_dx = l1Coeff[0] - centerXCoord;
            const l1_dy = l1Coeff[1] - centerYCoord;
            const l1_b_squared = (0.49 / (aspectRatio * aspectRatio)) + 1.96;
            const l1_b = Math.sqrt(l1_b_squared);
            const l1_a = aspectRatio * l1_b;
            ctx.beginPath();
            ctx.ellipse(centerX + centerXCoord * scale, centerY - centerYCoord * scale,
                l1_a * scale, l1_b * scale, 0, 0, 2 * Math.PI);
            ctx.stroke();
            const l2_dx = l2Coeff[0] - centerXCoord;
            const l2_dy = l2Coeff[1] - centerYCoord;
            const l2_distance = Math.sqrt(l2_dx * l2_dx + l2_dy * l2_dy);
            const l2_b = l2_distance * 0.8;
            const l2_a = l2_b * aspectRatio;
            ctx.beginPath();
            ctx.ellipse(centerX + centerXCoord * scale, centerY - centerYCoord * scale,
                l2_a * scale, l2_b * scale, 0, 0, 2 * Math.PI);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.restore();
        }

        function drawLegend() {
            const legendX = 630;
            const legendY = centerY - 2.5 * scale;
            ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
            ctx.fillRect(legendX, legendY, 240, 165);
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            ctx.strokeRect(legendX, legendY, 240, 165);
            ctx.fillStyle = colors.axes;
            ctx.font = 'bold 17px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('Regularization Effects', legendX + 5, legendY + 18);
            ctx.font = '17px Arial';
            let yPos = legendY + 35;
            const items = [
                { color: colors.original, text: 'Original β' },
                { color: colors.l0, text: 'L0 (Cardinality)' },
                { color: colors.l1, text: 'L1 (LASSO)' },
                { color: colors.l2, text: 'L2 (Ridge)' }
            ];
            items.forEach(item => {
                ctx.fillStyle = item.color;
                ctx.fillRect(legendX + 5, yPos - 6, 10, 6);
                ctx.fillStyle = colors.axes;
                ctx.fillText(item.text, legendX + 20, yPos);
                yPos += 16;
            });
            ctx.fillStyle = colors.axes;
            ctx.font = 'bold 17px Arial';
            ctx.fillText('Constraint Regions:', legendX + 5, yPos + 5);
            yPos += 20;
            const constraintItems = [
                { color: '#cccccc', text: 'Loss Contours (Ellipses)', dash: [3, 3] },
                { color: colors.l0, text: 'L0 Constraint (Axes)', dash: [10, 5] },
                { color: colors.l1, text: 'L1 Constraint (Diamond)', dash: [5, 5] },
                { color: colors.l2, text: 'L2 Constraint (Circle)', dash: [5, 5] }
            ];
            ctx.font = '17px Arial';
            constraintItems.forEach(item => {
                ctx.strokeStyle = item.color;
                ctx.lineWidth = 2;
                ctx.setLineDash(item.dash);
                ctx.beginPath();
                ctx.moveTo(legendX + 5, yPos - 3);
                ctx.lineTo(legendX + 15, yPos - 3);
                ctx.stroke();
                ctx.setLineDash([]);
                ctx.fillStyle = colors.axes;
                ctx.fillText(item.text, legendX + 20, yPos);
                yPos += 14;
            });
        }

        function drawTitle() {
            ctx.fillStyle = colors.axes;
            ctx.font = 'bold 29px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Coefficient Vector Regularization in 2D Space', 440, 48);
        }

        function drawVisualization() {
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, 880, 480);
            drawGrid();
            drawAxes();
            drawContourLines();
            drawConstraintRegions();
            drawVector(originalCoeff, colors.original, 'Original β*', 0);
            drawVector(l0Coeff, colors.l0, 'L0 Post-Regularization', 15);
            drawVector(l1Coeff, colors.l1, 'L1 Post-Regularization', 30);
            drawVector(l2Coeff, colors.l2, 'L2 Post-Regularization', 45);
            drawLegend();
            drawTitle();
        }

        function downloadImage() {
            const link = document.createElement('a');
            link.download = 'coefficient_regularization_2d.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        drawVisualization();
    </script>
</body>

</html>
</script>
</body>

</html>